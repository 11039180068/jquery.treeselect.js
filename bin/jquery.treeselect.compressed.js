(function(b){b.fn.treeselect=function(d){d=b.extend({colwidth:18,default_value:{},selected:null,treeloaded:null,load:null,searcher:null,deepLoad:!1,onbuild:null,postbuild:null,inputName:"treeselect",showRoot:!1,selectAll:!1,selectAllText:"Select All"},d);var h={},f=function(a,c){this.root=!!c;a.title=a.title||"anonymous";b.extend(this,{id:0,nodeloaded:!1,allLoaded:!1,value:0,title:"",url:"",has_children:!0,children:[],data:{},level:0,odd:!1,checked:!1,busy:!1,display:b(),input:b(),link:b(),span:b(),
childlist:b(),exclude:{}},a);this.isTreeNode=!0;this.loading=!1;this.loadqueue=[]};f.prototype.setBusy=function(a,c){a!=this.span.hasClass(c)&&((this.busy=a)?(this.span.addClass(c),this.span.addClass("treebusy")):(this.span.removeClass(c),this.span.hasClass("treebusy-loading"==c?"treebusy-selecting":"treebusy-loading")||this.span.removeClass("treebusy")))};f.prototype.isLoaded=function(){var a=this.nodeloaded,a=a|h.hasOwnProperty(this.id),a=a|!this.has_children;return a|=this.has_children&&0<this.children.length};
f.prototype.loadNode=function(a,c){if(this.loading)a&&this.loadqueue.push(a);else{var b=function(){a&&a(this);for(var e in this.loadqueue)this.loadqueue[e](this);this.loadqueue.length=0;c||this.setBusy(!1,"treebusy-loading")};this.loading=!0;d.load&&!this.isLoaded()?(c||this.setBusy(!0,"treebusy-loading"),d.load(this,function(a){return function(c){a.nodeloaded?b.call(a):(a=jQuery.extend(a,c),a.nodeloaded=!0,h[a.id]=a.id,a.build(function(){b.call(a)}))}}(this))):a&&b.call(this);this.loading=!1}};f.prototype.loadAll=
function(a,c,b,e){e=e||{};this.loadNode(function(d){c&&c(d);var f=d.children.length,k=f;if(!f||e.hasOwnProperty(d.id))a&&a(d);else{e[d.id]=d.id;for(b||d.setBusy(!0,"treebusy-loading");f--;)setTimeout(function(f){return function(){d.children[f].loadAll(function(){k--;k||(a&&a(d),b||d.setBusy(!1,"treebusy-loading"))},c,b,e)}}(f),2)}})};f.prototype.expand=function(a){this.checked=this.input.is(":checked");a?(this.link.removeClass("collapsed").addClass("expanded"),this.span.removeClass("collapsed").addClass("expanded"),
this.childlist.show("fast")):0<this.span.length&&(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),this.childlist.hide("fast"));a&&!this.isLoaded()&&this.loadNode(function(a){a.checked&&a.selectChildren(a.checked);a.expand(!0)})};f.prototype.selectChildren=function(a,c){var b,e=this;b=function(){e.setBusy(!0,"treebusy-selecting");for(var b=e.children.length;b--;)e.children[b].select(a),setTimeout(function(b){return function(){e.children[b].selectChildren(a,
!0)}}(b),2);d.selected&&d.selected(e,!c);e.setBusy(!1,"treebusy-selecting")};a&&d.deepLoad&&!c?this.loadAll(function(){b()}):b()};f.prototype.check=function(a){this.checked=a;this.input.attr("checked",a);d.selected&&d.selected(this,!0)};f.prototype.select=function(a){this.input.hasClass("treenode-no-select")||(this.checked=a,this.input.attr("checked",a))};f.prototype.build_treenode=function(){var a=b(),a=b(document.createElement(this.root?"div":"li"));a.addClass("treenode");a.addClass(this.odd?"odd":
"even");return a};f.prototype.build_input=function(a){if(d.inputName){if("undefined"!==typeof this.exclude[this.id])this.input=b(document.createElement("div")),this.input.addClass("treenode-no-select");else{this.input=b(document.createElement("input"));var c=this.value||this.id;this.input.attr({type:"checkbox",value:c,name:d.inputName+"-"+c,checked:this.checked}).addClass("treenode-input");this.input.bind("click",function(a){return function(c){c=b(c.target).is(":checked");a.expand(c);a.selectChildren(c)}}(this));
this.root&&!d.showRoot&&this.input.hide()}this.input.css("left",a+"px")}return this.input};f.prototype.build_link=function(a){a.css("cursor","pointer").addClass("collapsed");a.bind("click",{node:this},function(a){a.preventDefault();a.data.node.expand(b(a.target).hasClass("collapsed"))});return a};f.prototype.build_span=function(a){if((!this.root||this.showRoot)&&this.has_children)this.span=this.build_link(b(document.createElement("span")).attr({"class":"treeselect-expand"})),this.span.css("left",
a+"px");return this.span};f.prototype.build_title=function(a){if((!this.root||this.showRoot)&&this.title)this.nodeLink=b(document.createElement("a")).attr({"class":"treeselect-title",href:this.url,target:"_blank"}).css("marginLeft",a+"px").text(this.title),this.link=this.has_children?this.build_link(this.nodeLink.clone()):b(document.createElement("div")).attr({"class":"treeselect-title"}).css("marginLeft",a+"px").text(this.title);return this.link};f.prototype.build_children=function(a){this.childlist=
b();if(0<this.children.length){this.childlist=b(document.createElement("ul"));var c=this.odd,d=this.children.length,e;for(e in this.children)this.children.hasOwnProperty(e)&&(c=!c,this.children[e]=new f(b.extend(this.children[e],{level:this.level+1,odd:c,checked:this.checked,exclude:this.exclude})),this.children[e].build(function(b){d--;this.childlist.append(b.display);d||a.call(this,this.childlist)}))}else a.call(this,this.childlist)};f.prototype.build=function(a){var c=5,f=null;if(0==this.display.length)this.display=
this.build_treenode();else if(this.root){var e=this.build_treenode();this.display.append(e);this.display=e}if(0==this.input.length&&(f=this.build_input(c))&&0<f.length)this.display.append(f),c+=d.colwidth;0==this.span.length&&(this.display.append(this.build_span(c)),c+=d.colwidth);0==this.link.length&&this.display.append(this.build_title(c));var n=function(){if(d.onbuild)d.onbuild(this);this.searchItem=this.display.clone();b(".treeselect-expand",this.searchItem).remove();var c=b("div.treeselect-title",
this.searchItem);0<c.length&&c.replaceWith(this.nodeLink);d.postbuild&&d.postbuild(this);"undefined"!==typeof this.exclude[this.id]&&0==b(".treenode-input",this.display).length&&this.display.hide();a&&a.call(this,this)};0==this.childlist.length?this.build_children(function(a){this.display.append(a);n.call(this)}):n.call(this)};f.prototype.getSelectAll=function(){return this.root&&this.selectAll?this.selectAllText:!1};f.prototype.setDefault=function(a,b){jQuery.isEmptyObject(a)?b&&b(this):this.loadAll(function(a){b&&
b(a)},function(b){(a.hasOwnProperty(b.value)||a.hasOwnProperty(b.id))&&b.check(!0)})};f.prototype.search=function(a,b){if(a){var g={};a=a.toLowerCase();d.searcher?d.searcher(this,a,function(a,d){var l=null,k=a.length,j;for(j in a)l=new f(d?d(a[j]):a[j]),l.nodeloaded=!0,h[l.id]=l.id,l.build(function(){k--;g[j]=l;k||b(g,!0)})}):this.loadAll(function(){b&&b(g,!0)},function(b){!b.root&&-1!==b.title.toLowerCase().search(a)&&(g[b.id]=b)},!0)}else b&&b(this.children,!1)};return b(this).each(function(){var a=
b.extend(d,{display:b(this)}),a=this.treenode=new f(a,!0),c=a.getSelectAll();!1!==c&&!a.showRoot&&(a.display.append(b(document.createElement("input")).attr({type:"checkbox"}).bind("click",function(a){return function(c){a.selectChildren(b(c.target).is(":checked"));d.selected&&d.selected(a,!0)}}(a))),c&&(c=b(document.createElement("span")).attr({"class":"treeselect-select-all"}).html(c),a.display.append(c)));var g=b(document.createElement("span")).addClass("treebusy");a.display.append(g);a.loadNode(function(a){g.remove();
0==a.children.length&&a.display.hide();a.checked&&a.selectChildren(a.checked);a.expand(!0);a.setDefault(d.default_value,function(a){d.treeloaded&&d.treeloaded(a)})});a.has_children||(this.parentElement.style.display="none")})}})(jQuery);
(function(b){b.fn.chosentree=function(d){d=b.extend({inputId:"chosentree-select",label:"",description:"",input_placeholder:"Select Item",input_type:"text",autosearch:!1,search_text:"Search",no_results_text:"No results found",min_height:100,more_text:"+%num% more",loaded:null,collapsed:!0,showtree:!1},d);return b(this).each(function(){var h=null,f=null,a=null,c=null,g=null,e=null,n=null,l=null,k=e=null,j=null,p=function(a){a&&(null==j||j.has_children)?k.addClass("treevisible").show("fast"):k.removeClass("treevisible").hide("fast")},
h=b(document.createElement("div"));h.addClass("chzntree-container");"search"==d.input_type?(h.addClass("chzntree-container-single"),a=b(document.createElement("div")),a.addClass("chzntree-search")):(h.addClass("chzntree-container-multi"),f=b(document.createElement("ul")),f.addClass("chzntree-choices chosentree-choices"),a=b(document.createElement("li")),a.addClass("search-field"));e=b(document.createElement("label"));e.attr({"for":d.inputId});e.text(d.label);l=b(document.createElement("div"));l.attr({"class":"description"});
l.text(d.description);if(d.input_placeholder){c=b(document.createElement("input"));c.attr({type:"text",placeholder:d.input_placeholder,autocomplete:"off"});!d.showtree&&d.collapsed&&c.focus(function(){p(!0)});if("search"==d.input_type){c.addClass("chosentree-search");var q=function(a){return!c.hasClass("searching")&&1!==a.length&&j?(c.addClass("searching"),j.search(a,function(a,b){c.removeClass("searching");var f=0;j.childlist.children().detach();b?j.childlist.addClass("chzntree-search-results"):
j.childlist.removeClass("chzntree-search-results");for(var e in a)f++,b?j.childlist.append(a[e].searchItem):j.childlist.append(a[e].display);f||j.childlist.append("<li>"+d.no_results_text+"</li>")}),!0):!1};if(d.autosearch){var s=0;c.bind("input",function t(){q(c.val())||(clearTimeout(s),s=setTimeout(t,1E3))});a.addClass("autosearch")}else g=b(document.createElement("input")),g.attr({type:"button",value:d.search_text}),g.addClass("chosentree-search-btn"),g.bind("click",function(a){a.preventDefault();
q(c.val())}),jQuery(document).bind("keydown",function(a){13==a.keyCode&&c.is(":focus")&&(a.preventDefault(),q(c.val()))}),a.addClass("manualsearch")}else c.addClass("chosentree-results");a.append(c);g&&a.append(g)}f?h.append(e).append(f.append(a)):h.append(e).append(a);k=b(document.createElement("div"));k.addClass("treewrapper");k.hide();n=b(document.createElement("span")).attr({"class":"tree-loading treebusy"}).css("display","block");e=b(document.createElement("div"));e.addClass("treeselect");b(this).keyup(function(a){27==
a.which&&p(!1)});k.append(e.append(n));b(this).append(h.append(k));b(this).append(l);var m=d,r=this;m.selected=function(e,j){var g=b("li#choice_"+e.id,f);if(e.id)if(e.checked&&0==g.length){g=b(document.createElement("li"));g.addClass("search-choice");g.attr("id","choice_"+e.id);g.eq(0)[0].nodeData=e;var k=b(document.createElement("span"));k.text(e.title);if(!e.root||e.showRoot&&e.has_children){var h=b(document.createElement("a"));h.addClass("search-choice-close");h.attr("href","javascript:void(0)");
h.bind("click",function(a){a.preventDefault();b("li#choice_"+e.id,f).remove();e.selectChildren(!1)})}a.before(g.append(k).append(h))}else e.checked||g.remove();if(j){var l=[];r.value={};f.show();c&&0==e.children.length&&c.attr({value:""});b("li.search-choice",f).each(function(){r.value[this.nodeData.id]=this.nodeData.value;l.push(this.nodeData)});jQuery.fn.moreorless&&(h=d.more_text.replace("%num%",l.length),f.moreorless(d.min_height,h),f.div_expanded||p(!0,null));m.loaded&&m.loaded(l);b(r).trigger("treeloaded")}};
m.treeloaded=function(){n.remove()};e.treeselect(m);j=e.eq(0)[0].treenode;(m.showtree||!m.collapsed)&&p(!0,null)})}})(jQuery);
